(window.webpack=window.webpack||[]).push([[2],{"./src/app/features/Promo/PromozavrContainer.tsx":function(e,t,n){"use strict";n.r(t);var r,s,o,a,i=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),c=n.n(i),u=n("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),l=n.n(u),p=n("./node_modules/@babel/runtime/helpers/jsx.js"),d=n.n(p),m=n("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),f=n.n(m),g=n("./node_modules/@babel/runtime/helpers/slicedToArray.js"),b=n.n(g),h=n("./node_modules/@babel/runtime/regenerator/index.js"),k=n.n(h),v=n("./node_modules/react/index.js"),y=n.n(v),j=n("./src/lib/resolve/withSafeResolve.tsx"),T=n("./src/lib/dispatch/Dispatch.ts"),P=n("./node_modules/@ps-int/promozavr/index.js"),w=(n("./node_modules/@ps-int/promozavr/app/api/types.js"),n("./node_modules/@ps-int/promozavr/app/PromozavrConfig.js")),O=n("./node_modules/@ps-int/promozavr/app/PromoSelector.js"),M=n("./node_modules/@ps-int/promozavr/app/features/registry/index.js"),C=n("./node_modules/@ps-int/promozavr/app/types.js"),x=n("./node_modules/@ps-int/mg-theme/ps-light.js"),I=n("./node_modules/@ps-int/mg-theme/ps-dark.js"),S=(n("./node_modules/@ps-int/360-components/dist/components/Theme/index.js"),n("./src/lib/inject/Inject.ts")),_=n("./src/lib/resolve/index.ts"),E=n("./src/app/state/app/models/ClockModel.ts"),D=n("./src/app/state/app/models/CurrentPageModel.ts"),z=n("./src/app/state/app/models/EnvironmentConfigModel.ts"),A=n("./src/app/state/settings/models/SettingsModel.ts"),N=n("./src/app/state/app/models/UserConfigModel.ts"),L=n("./src/app/state/app/models/UrlsConfigModel.ts"),R=n("./src/app/state/app/models/AccountInformationModel.ts"),B=n("./src/app/state/promo/models/PromozavrStateModel.ts"),U=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),G=n.n(U),Y=n("./node_modules/@babel/runtime/helpers/createClass.js"),H=n.n(Y),K=n("./node_modules/@babel/runtime/helpers/inherits.js"),q=n.n(K),F=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),W=n.n(F),$=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),J=n.n($),Q=n("./src/lib/middleware/process.ts"),V=n("./src/lib/noscript/NsModel.ts"),X=n("./src/lib/mobx/HighLevelModel.ts"),Z=Object(V.a)("messages")(((s=function(){function e(t){G()(this,e),this.message=[]}return H()(e,[{key:"normalMessages",get:function(){return this.message.filter((function(e){return!e.type.includes("12")&&"yadisk"!==e.dlid}))}}]),e}()).Token=Object(S.d)(s),r=s))||r,ee=Object(X.a)()(((a=function(){function e(t){G()(this,e),this.params=t}return H()(e,[{key:"messages",get:function(){return this.params.injector.Instance(Z.Token(this.params.currentPage.rawParams))}}]),e}()).Token=Object(S.d)(a,{currentPage:D.a.Token(),injector:S.c.Token()}),o=a))||o,te=n("./src/app/state/settings/processes/SettingsUpdateProcess.ts");function ne(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=J()(e);if(t){var s=J()(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return W()(this,n)}}var re,se,oe=function(e){q()(n,e);var t=ne(n);function n(){return G()(this,n),t.apply(this,arguments)}return H()(n,[{key:"run",value:function(){var e=this.params,t=e.dispatcher,n=e.currentMessages;return e.settings.hasInboxMessages?Promise.resolve():n.messages.normalMessages.length?t.dispatch(new te.a({settings:{has_inbox_message:!0},optimistic:!0})):Promise.resolve()}}]),n}(Q.a);oe.Token=Object(S.a)(oe,(function(){return{currentMessages:ee.Token(),settings:A.a.Token(),dispatcher:T.a.Token()}}));var ae=Object(X.a)()(((se=function(){function e(t){G()(this,e),this.params=t}return H()(e,[{key:"registrationDays",get:function(){return Math.floor((this.params.clock.promoNow-this.params.accountInfo.registrationDate)/864e5)}},{key:"backup",get:function(){var e=this.params.settings.canUseBackup;return{available:e,enabled:!!e&&this.params.settings.backupEnabled}}},{key:"beautifulEmail",get:function(){var e=this.params.settings.canUseBeautifulEmail;return{available:e,enabled:!!e&&Boolean(this.params.accountInfo.beautifulEmail)}}},{key:"optInSubs",get:function(){var e=this.params.settings.canUseOptInSubs;return{available:e,enabled:!!e&&this.params.settings.optInSubsEnabled}}},{key:"firstLogin",get:function(){return!(this.params.settings.hasInboxMessages||this.params.currentMessages.messages.normalMessages.length>0)}}]),e}()).Token=Object(S.d)(se,{accountInfo:R.a.Token(),clock:E.a.Token(),settings:A.a.Token(),currentMessages:ee.Token()}),re=se))||re,ie=n("./src/app/state/datasync/models/PsPromoClient.ts"),ce=n("./src/app/features/Promo/PromozavrBridge.ts"),ue=n("./src/app/state/themes/models/CurrentThemeModel.ts"),le=n("./src/app/state/promo/models/DebugModel.ts"),pe=n("./src/app/state/app/processes/LogErrorProcess.ts"),de=function(){function e(t){G()(this,e),this.params=t}return H()(e,[{key:"info",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=this.params.debug).info.apply(e,["[promozavr]"].concat(n))}},{key:"warn",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=this.params.debug).warn.apply(e,["[promozavr]"].concat(n))}},{key:"error",value:function(e){this.params.injector.Instance(T.a.Token()).dispatch(new pe.a({error:e,errorType:"promozavr"}))}}]),e}();de.Token=Object(S.d)(de,{debug:le.a.Token(),injector:S.c.Token()});var me,fe,ge=n("./src/lib/configs/session.ts"),be=n("./src/lib/mobx/ReadonlyModel.ts"),he=Object(be.a)({initialState:ge.d})(((fe=H()((function e(){G()(this,e),this.enabledExpIds=[]}))).Token=Object(S.d)(fe),me=fe))||me,ke=n("./src/app/state/products/models/ProductsModel.ts"),ve=n("../client/lib/metrika/logger.ts"),ye=n("./node_modules/@ps-int/general-themes/index.js"),je=n("./node_modules/@ps-int/general-themes/settings/helpers.js"),Te=n("./src/app/state/themes/datasync.ts");function Pe(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return we(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return we(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,s=function(){};return{s:s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){i=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}function we(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Oe=function(){function e(t){G()(this,e),this.params=t}return H()(e,[{key:"checkConditions",value:function(e){var t,n=Pe(e);try{for(n.s();!(t=n.n()).done;){var r,s=t.value,o=null===(r=s.expected)||void 0===r||r;if(s.actual!==o)return this.params.debug.info("checker","[".concat(s.message,"] failed. Expected: ["),o,"], actual: [",s.actual,"]"),!1}}catch(e){n.e(e)}finally{n.f()}return!0}}]),e}();Oe.Token=Object(S.d)(Oe,{debug:le.a.Token()});var Me=function(){function e(t){G()(this,e),this.params=t,this.id="newYear2023ClosingTooltip"}var t;return H()(e,[{key:"check",value:(t=f()(k.a.mark((function e(){var t,n,r,s;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=ye.ThemeName.GeneralNewYear2023,n=new Date(this.params.clockModel.promoNow),r=this.params.generalThemesDatasync.isGeneralThemeEnabled(t),s=Object(je.isThemeAvailable)(t,n),e.abrupt("return",this.params.checkerModel.checkConditions([{actual:r,expected:!0,message:"Включена тема ".concat(ye.ThemeName.GeneralNewYear2023)},{actual:s,expected:!1,message:"Недоступна тема ".concat(ye.ThemeName.GeneralNewYear2023," на дату ").concat(n)}]));case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();Me.Token=Object(S.d)(Me,{generalThemesDatasync:Te.a.Token(),clockModel:E.a.Token(),checkerModel:Oe.Token()});var Ce=["currentPage","envConfig","settings","userConfig","promozavrState","urlsConfig","accountInfo","dispatcher","promozavrConfig","bridge","currentMessages","currentTheme","session"];function xe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var Ie=function(e){var t=e.lang,n=e.dsClient,r=e.uid,s=e.clock,o=e.subscription,a=e.segment,i=e.projectSettings,c=e.onLegacyCheck,u=e.legacyPromoNames,l=e.onLegacyShow,p=e.tld,m=e.promoDisabled,g=e.currentTheme,h=e.isComposeExpanded,y=e.logger,j=e.enabledExpIds,T=e.page,S=e.injector,_=e.modelTransport,E=e.urls,D=Object(v.useMemo)((function(){var e;return g?g.color===I.PS_DARK.color:null===(e=document.querySelector("html"))||void 0===e?void 0:e.classList.contains("with-dark-content")}),[g]),z=D?I.PS_DARK:x.PS_LIGHT,A=Object(v.useState)(),N=b()(A,2),L=N[0],R=N[1],B=Object(v.useCallback)((function(){return s.promoNow}),[s]),U=Object(v.useCallback)((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return ve.a.logMetric(t)}),[]),G=Object(v.useRef)(!0),Y=Object(v.useRef)(null),H=Object(v.useMemo)((function(){return new w.a("/web-api/shared/models",r,y)}),[y,r]),K=Object(v.useMemo)((function(){return[S.Instance(Me.Token())]}),[S]),q=Object(v.useCallback)(f()(k.a.mark((function e(){var t;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=S.Instance(ke.a.Token()),e.next=3,_.resolveModels(t);case 3:if(!t.error){e.next=5;break}return e.abrupt("return",Promise.reject(t.error));case 5:return e.abrupt("return",t.getPromos());case 6:case"end":return e.stop()}}),e)}))),[S,_]),F=Object(v.useMemo)((function(){return new O.a({project:C.a.mailDesktop,lang:t,getNow:B,config:H,dsClient:n,onLegacyCheck:c,legacyPromoNames:u,logger:y,plugins:K,getBillingPromos:q})}),[t,B,H,n,c,u,y,K,q]),W=Object(v.useMemo)((function(){return{subscription:o,segment:a,testids:j,project:C.a.mailDesktop,settings:i,tld:p,promoDisabled:m}}),[o,a,j,i,p,m]),$=Object(v.useCallback)((function(){L&&u.includes(L.promo.name)&&l(L.promo.name)}),[L,u,l]);return Object(v.useEffect)((function(){var e=function(){var e=f()(k.a.mark((function e(){var t,n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!L){e.next=2;break}return e.abrupt("return");case 2:return t=G.current?"page-init":"page-changed",t=h?"compose":t,G.current=!1,Y.current||(y.info("Выбираем промо для стадии ".concat(t," и страницы ").concat(T)),Y.current=null==F?void 0:F.selectPromo(W,{stage:t,page:T})),e.next=8,Y.current;case 8:n=e.sent,R(n),Y.current=null;case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e().catch()}),[L,T,F,h,W,y]),L?d()(P.a,{lang:t,currentPromo:L,sendMetric:U,theme:z,darkTheme:I.PS_DARK,lightTheme:x.PS_LIGHT,isDark:D||!1,config:H,dsClient:n,getNow:B,onShow:$,registry:M.a,plugins:K,urls:E,uid:r}):null};t.default=Object(j.a)((function(){return{clock:E.a.Token(),currentPage:D.a.Token(),envConfig:z.a.Token(),settings:A.a.Token(),userConfig:N.a.Token(),promozavrState:B.a.Token(),urlsConfig:L.a.Token(),accountInfo:R.a.Token(),dispatcher:T.a.Token(),promozavrConfig:ae.Token(),bridge:ce.a.Token(),currentMessages:ee.Token(),currentTheme:ue.a.Token(),dsClient:ie.a.Token(),logger:de.Token(),session:he.Token(),injector:S.c.Token(),modelTransport:_.a.Token()}}))((function(e){var t,n=e.currentPage,r=e.envConfig,s=e.settings,o=e.userConfig,a=e.promozavrState,i=e.urlsConfig,u=(e.accountInfo,e.dispatcher),p=e.promozavrConfig,d=e.bridge,m=e.currentMessages,f=e.currentTheme,g=e.session,b=l()(e,Ce);return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xe(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({isPromoPage:n.isPromoPage,page:n.path,promoDisabled:s.isPromoDisabled,lang:o.lang,uid:o.uid,isInitialized:a.isInitialized,subscription:o.hasPro?C.c.paid:C.c.free,segment:o.isB2BUser?C.b.b2b:C.b.b2c,cloudApi:i.cloudApi,hasInboxMessages:s.hasInboxMessages,firstLogin:!(s.hasInboxMessages||m.messages.normalMessages.length>0),tld:r.tld,projectSettings:{areTabsEnabled:s.areTabsEnabled,backup:p.backup,beautifulEmail:p.beautifulEmail,browserNotifications:s.browserNotifications,firstLogin:p.firstLogin,hasMobileApp:o.hasMobileApp,isCorp:r.isCorp,optInSubs:p.optInSubs,registrationDays:p.registrationDays},onFirstLogin:function(){return u.dispatch(oe.Token())},legacyPromoNames:d.legacyPromoNames,onLegacyCheck:function(e){return d.checkPromo(e)},onLegacyShow:function(e){return d.showPromo(e)},currentTheme:null===(t=f.theme)||void 0===t?void 0:t.content.base,isComposeExpanded:a.isComposeExpanded,enabledExpIds:g.enabledExpIds,urls:{tuning:i.mail360}},b)}))((function(e){return e.isInitialized&&e.isPromoPage?y.a.createElement(Ie,e):null}))},"./src/lib/configs/session.ts":function(e,t,n){"use strict";n.d(t,"d",(function(){return s})),n.d(t,"f",(function(){return o})),n.d(t,"g",(function(){return a})),n.d(t,"a",(function(){return i})),n.d(t,"h",(function(){return c})),n.d(t,"e",(function(){return u})),n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return p}));var r=n("./src/lib/configs/config.ts"),s=Object(r.a)("session"),o=s.params,a=s.regionId,i=s.connectionId,c=s.version,u=s.nonce,l=s.experiments,p=(s.enabledExpIds,s.features)}}]);